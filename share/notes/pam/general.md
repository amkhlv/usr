Manuals
=======

[All](http://www.linux-pam.org/Linux-PAM-html/)

Description of PAM modules
--------------------------

[here](http://www.linux-pam.org/Linux-PAM-html/sag-module-reference.html)

In particular:

1. [pam_unix](http://www.linux-pam.org/Linux-PAM-html/sag-pam_unix.html) is the traditional password authentication

2. [pam_script](https://linux.die.net/man/5/pam_script)

3. [pam_permit](http://www.linux-pam.org/Linux-PAM-html/sag-pam_permit.html) is promiscous 

4. [pam_deny](http://www.linux-pam.org/Linux-PAM-html/sag-pam_deny.html) is locking-out


Configuration files in /etc/pam.d
=================================

<b><span style="color:red;">The files in /etc/pam.d are autogenerated</span></b> so you
should not edit them directly.

Instead see the [writeup on pam-auth-update](pam-auth-update.md)

The directory is `/etc/pam.d`.


The __service__ is the name of the file in the `/etc/pam.d/` directory; must be lowcase.


Line entries
------------

The line entries in the file are of the form:

    type control module-path module-arguments

(And, remember, there is also __service__ which is the name of file; so the actual array is `(service type control module-path module-arguments)`.)

### type

The type could be any of the following:

1. __account__ : this module type performs __non-authentication based__ account management. It is typically used to restrict/permit access to a service based on the time of day,
currently available system resources (maximum number of users) or perhaps the location of the applicant user -- 'root' login only on the console.

2. __auth__ : this module type provides two aspects of authenticating the user. Firstly, it establishes that the user is who they claim to be,
by instructing the application to prompt the user for a password or other means of identification. Secondly, the module can grant group membership
or other privileges through its credential granting properties.

3. __password__ : this module type is required for updating the authentication token associated with the user. Typically, there is one module for each 'challenge/response'
based authentication (auth) type.

4. __session__ : this module type is associated with doing things that need to be done for the user before/after they can be given service.
Such things include the logging of information concerning the opening/closing of some data exchange with a user, mounting directories, etc.

### control

This specifies what to do if the module fails.

There are two types of syntax for the `control` field:

1. __simple__ : only the following possible values:

    - __required__ : failure of such a PAM will ultimately lead to the PAM-API returning failure but only after the remaining stacked modules (for this service and type) have been invoked.

    - __requisite__ : like required, however, in the case that such a module returns a failure,
    control is directly returned to the application or to the superior PAM stack.
    The return value is that associated with the first required or requisite module to fail.
    Note, this flag can be used to protect against the possibility of a user getting the opportunity to enter a password over an unsafe medium.

    - __sufficient__ : if such a module succeeds and no prior required module has failed, then 
    the PAM framework returns success to the application or to the superior PAM stack immediately _without calling any further modules_ in the stack.
    A failure of a sufficient module is ignored and processing of the PAM module stack continues unaffected.

    - __optional__ : the success or failure of this module is only important if it is the only module in the stack associated with this service+type.

    - __include__ : include all lines of given type from the configuration file specified as an argument to this control.

    - __substack__ : include all lines of given type from the configuration file specified as an argument to this control.
    This differs from include in that evaluation of the done and die actions in a substack does not cause skipping the rest of the complete module stack, but only of the substack.
    Jumps in a substack also can not make evaluation jump out of it, and the whole substack is counted as one module when the jump is done in a parent stack.
    The reset action will reset the state of a module stack to the state it was in as of beginning of the substack evaluation.

2. __complicated__ : values of the form: `[value1=action1 value2=action2 ...]`
where `valueN` corresponds to the return code from the function invoked in the module for which the line is defined. 

Here are the possible return codes (_i.e._ values of the symbol `valueN`):

    success, open_err, symbol_err, service_err, system_err, buf_err, perm_denied, auth_err, cred_insufficient,
    authinfo_unavail, user_unknown, maxtries, new_authtok_reqd, acct_expired, session_err, cred_unavail, cred_expired,
    cred_err, no_module_data, conv_err, authtok_err, authtok_recover_err, authtok_lock_busy, authtok_disable_aging,
    try_again, ignore, abort, authtok_expired, module_unknown, bad_item, conv_again, incomplete, and default

The last of these, `default`, implies all `valueN`s not mentioned explicitly. Note, the full list of PAM errors is available in `/usr/include/security/_pam_types.h`.
The actionN can take one of the following forms:

       ignore
           when used with a stack of modules, the module's return status will not contribute to the return code the application obtains.

       bad
           this action indicates that the return code should be thought of as indicative of the module failing. If this module is the first in the stack to fail, its status value will be used
           for that of the whole stack.

       die
           equivalent to bad with the side effect of terminating the module stack and PAM immediately returning to the application.

       ok
           this tells PAM that the administrator thinks this return code should contribute directly to the return code of the full stack of modules. In other words, if the former state of the
           stack would lead to a return of PAM_SUCCESS, the module's return code will override this value. Note, if the former state of the stack holds some value that is indicative of a modules
           failure, this 'ok' value will not be used to override that value.

       done
           equivalent to ok with the side effect of terminating the module stack and PAM immediately returning to the application.

       N (an unsigned integer)
           equivalent to ok with the side effect of jumping over the next N modules in the stack. Note that N equal to 0 is not allowed (and it would be identical to ok in such case).

       reset
           clear all memory of the state of the module stack and start again with the next stacked module.

       Each of the four keywords: required; requisite; sufficient; and optional, have an equivalent expression in terms of the [...] syntax. They are as follows:

       required
           [success=ok new_authtok_reqd=ok ignore=ignore default=bad]

       requisite
           [success=ok new_authtok_reqd=ok ignore=ignore default=die]

       sufficient
           [success=done new_authtok_reqd=done default=ignore]

       optional
           [success=ok new_authtok_reqd=ok default=ignore]

       module-path is either the full filename of the PAM to be used by the application (it begins with a '/'), or a relative pathname from the default module location: /lib/security/ or
       /lib64/security/, depending on the architecture.

       module-arguments are a space separated list of tokens that can be used to modify the specific behavior of the given PAM. Such arguments will be documented for each individual module.
       Note, if you wish to include spaces in an argument, you should surround that argument with square brackets.



